<html>

<head>
	<style>
		@import url('https://fonts.googleapis.com/css?family=Roboto:400,700');
		body,input {
			font-family: Roboto;
			font-size: 12pt;
		}

		body {
			background-color: #eee;
			color: #000;
		}

		table,tbody {
			vertical-align: top
		}

	

		#maps_chart svg,#tree_chart svg,#piechart svg,#curve_chart svg,#legend {
			border: solid 1px #ccc;
			background: #fff
		}

		.arrange-horizontally > * {
			display: inline-block;
		}
		
	</style>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="easyac/jquery.easy-autocomplete.min.js"></script>
	<link rel="stylesheet" href="easyac/easy-autocomplete.min.css">
	<script type="text/javascript">
		// Load Tradedata
		var tdata;

		function getCountries() {
			var lst = [];
			$.each(tdata, function (k, v) {
				lst.push({ "name": v, "code": k });
			});
			return lst;
		}

		$(document).on("tdata_loaded", function () {
			// init autocomplete texlinesSettingstfield
			var options = {
				data: getCountries(),
				getValue: "name",
				list: {
					onChooseEvent: function () {
						//selectedCountry();
						loadDataForSelectedCountry();
					},
					match: {
						enabled: true
					}
				}
			};
			$("#c_selector").easyAutocomplete(options);
			$("#r_selector").easyAutocomplete(options);
		});

		$(document).ready(function () {
			$.getJSON("data/cc_list.json", function (data) {
				tdata = data;
				$(document).trigger("tdata_loaded");
			});
		});
	</script>

	<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
	<script type="text/javascript">
		google.charts.load('current', {
			'packages': ['geochart', 'treemap', 'corechart'],
			'mapsApiKey': 'AIzaSyD-9tSrke72PouQMnMX-a7eZSW0jkFMBWY'
		});
		google.charts.setOnLoadCallback(drawRegionsMap);
		
		
		
		function drawRegionsMap() {
			var geodata = google.visualization.arrayToDataTable([
				['Country', 'Popularity'],
				['Germany', -100000],
				['United States', 300],
				['Brazil', 400],
				['Canada', 500],
				['France', 600],
				['RU', 700]
			]);

			var geooptions = {
				colorAxis: { colors: ['#e31b23', '#fff', '#00853f'] },
				keepAspectRatio: true,
			};

			var geochart = new google.visualization.GeoChart(document.getElementById('maps_chart'));
			geochart.draw(geodata, geooptions);


			const colors = ['#3366cc','#dc3912','#ff9900','#66aa00','#b82e2e','#994499','#22aa99','#b77322','#f4359e','#109618'/*,others:'#f5f5f5'*/];

			let rawPieData = [
				['Animal',5],
				['Vegetable',5],
				['Food Products',5],
				['Minerals',3],
				['Fuels',3],
				['Chemicals',2],
				['Plastic or Rubber',4],
				['Hides and Skins',15],
				['Wood',5],
				['Textiles and Clothing',6],
				['Footwear',7],
				['Capital goods',1],
				['Stone and Glass',10],
				['Metals',8],
				['Mach and Elec',5],
				['Transportation',8],
				['Miscellaneous',8], 
				['Agricultural Raw Materials',9], 
				['Chemical',10], 
				['Food',10], 
				['Fuel',10],
				['Manufactures',15],
				['Ores and Metals',40], 
				['Textiles',3], 
				['Machinery and Transport Equipment',1],
				['Raw materials',2],
				['Intermediate goods',11], 
				['Consumer goods',12]
			];
			var pieData = google.visualization.arrayToDataTable([['WareItem','units']].concat(rawPieData));
			pieData.sort({column: 1, desc: true});
			//calculating threshold to display top 10 values
			let pieDataThreshold = pieData.getValue(9,1) / getTotal(rawPieData);
			
			var pieOptions = {
				chartArea: {'width': '100%', 'height': '100%'},
				legend: 'none',
				colors: colors,
				sliceVisibilityThreshold: pieDataThreshold
			};

			var piechart = new google.visualization.PieChart(document.getElementById('piechart'));
			piechart.draw(pieData, pieOptions);
			
			


			var treedata = google.visualization.arrayToDataTable([
				['Location', 'Parent', 'Market trade volume (size)', 'Market increase/decrease (color)'],
				['Global', null, 0, 0],
				['Brazil', 'Global', 11, 10],
				['USA', 'Global', 52, 31],
				['Mexico', 'Global', 24, 12],
				['Canada', 'Global', 16, -23],
				['France', 'Global', 42, -11],
				['Germany', 'Global', 31, -2],
				['Sweden', 'Global', 22, -13],
				['Italy', 'Global', 17, 4],
				['UK', 'Global', 21, -5],
				['China', 'Global', 36, 4],
				['Japan', 'Global', 20, -12],
				['India', 'Global', 40, 63],
				['Laos', 'Global', 4, 34],
				['Mongolia', 'Global', 1, -5],
				['Israel', 'Global', 12, 24],
				['Iran', 'Global', 18, 13],
				['Pakistan', 'Global', 11, -52],
				['Egypt', 'Global', 21, 0],
				['S. Africa', 'Global', 30, 43],
				['Sudan', 'Global', 12, 2],
				['Congo', 'Global', 10, 12],
				['Zaire', 'Global', 8, 10]
			]);

			var tree = new google.visualization.TreeMap(document.getElementById('tree_chart'));
			tree.draw(treedata, {
				minColor: '#e31b23',
				midColor: '#fff',
				maxColor: '#00853f',
				headerHeight: 0,
				fontColor: 'black',
				showScale: false
			});
		}
		
		function drawLineChart(){
		
			var linedata = new google.visualization.DataTable();
			var linerawdata =[];
			
			linedata.addColumn('number','Year');
			for(trades of tradeDataLineChart){
				
				for(imports of trades.imports)
					if(!linerawdata.includes(imports.name))
						linerawdata.push(imports.name);
			}
			
			for(tmp of linerawdata){
				linedata.addColumn('number',tmp);
			}
			
			var rawArr =[];
			
			for(trades of tradeDataLineChart){
				var inputs =[];
				inputs.push(trades.year);
				for(imports of trades.imports){
						inputs.push(imports.percent);
					}
				rawArr.push(inputs);
			}
			
			
			linedata.addRows(rawArr);
			
			var lineoptions = {
				curveType: 'function',
				legend: 'none',
				hAxis: {
					format: '####'
				}
			};
			
			var linechart = new google.visualization.LineChart(document.getElementById('curve_chart'));
			linechart.clearChart();
			
			
			linechart.draw(linedata, lineoptions);
			rawArr=[];
			linerawdata=[];
			linedata.removeColumns(0,linedata.getNumberOfColumns());
			linedata.removeRows(0,linedata.getNumberOfRows());
		}

		function getTotal(dataArray) {
			let total = 0;
			for (let i = 0; i < dataArray.length; i++) {
			total += dataArray[i][1];
			}
			return total;
		}
	</script>

	<script type="text/javascript">	
		function selectedCountry() {
			var ccode = $("#c_selector").getSelectedItemData().code;

			var baseCountry = { "Name": tdata["cc_index"][ccode]["Name"], "Latitude": tdata["cc_index"][ccode]["Latitude"], "Longitude": tdata["cc_index"][ccode]["Longitude"] };
			var tradeData = [];

			$.each(tdata["trade_data"][ccode], function (exp_key, ec) {
				tradeData.push({
					"Name": tdata["cc_index"][exp_key]["Name"],
					"Latitude": tdata["cc_index"][exp_key]["Latitude"],
					"Longitude": tdata["cc_index"][exp_key]["Longitude"],
					"ExportAmount": tdata["trade_data"][ccode][exp_key]["ExportAmount"],
					"ImportAmount": tdata["trade_data"][ccode][exp_key]["ImportAmount"],
					"ExportAmountPercentage": tdata["trade_data"][ccode][exp_key]["ExportAmountPercentage"],
					"ImportAmountPercentage": tdata["trade_data"][ccode][exp_key]["ImportAmountPercentage"]
				});
			});
		}
	</script>
	
	<script type="text/javascript">	
	
		var  tradeDataLineChart = [];
		var  jsonTradeData;
		
		function loadDataForSelectedCountry() {
		
			var code = $("#c_selector").getSelectedItemData().code;
			code = code.toLowerCase();
			
			$.getJSON("data/aggregate_"+code+".json", function (data) {
			
				jsonTradeData = data;
				$(document).trigger("selectedTradeDataLoaded");
			});
			
		}
		
		function getDataFromLoadedDataForSelectedCountry(){
			tradeDataLineChart = [];
			$.each(jsonTradeData["years"], function(year,data){
			
				var yearExport = [];
				var yearImport = [];
				
				$.each(data["imports"],function(name,percent){
					if(percent.id !== "Total")
						yearImport.push({"name":percent.name,"percent":percent.percent})
					
				});
				
				$.each(data["exports"],function(name,percent){
					if(percent.id !== "Total")
						yearExport.push({"name":percent.name,"percent":percent.percent})
					
				});
				
				tradeDataLineChart.push({"year":data.year,"imports":yearImport, "exports":yearExport})
			});
			
			
			drawLineChart();
		}
		
		$(document).on("selectedTradeDataLoaded", function () {
			
			var options =getDataFromLoadedDataForSelectedCountry();
				
			
			$("#c_selector").easyAutocomplete(options);
			$("#r_selector").easyAutocomplete(options);
		});
		
		
	</script>

</head>

<body style="height:100%; width:100%">
		
	<table style="width:100%; height:100%; position: absolute; top:0; left:0">
		<tr style="height:10%; width: 100%">
			<th style="width:70%">
				<div class="arrange-horizontally" style="float: left;">
					Select Country: <input type="text" name="c_selector" id="c_selector"/>
				</div>
			</th>
			<th style="width:30%">
				<div class="arrange-horizontally" style="float: left;">
					Select Resource: <input type="text" name="r_selector" id="r_selector" />
				</div>
			</th>
		</tr>
		<tr style"height:70%; width:100%">
			<td style="width:70%;">
				<div id="maps_chart"></div>
			</td>
			<td style="width:30%;">
				<div id="piechart" style="height:50%; width:100%"></div>
				<div id="legend" style="height:10%; width:100%">Hello World!</div>
				<div id="curve_chart" style="height:40%; width:100%"></div>
			</td>
		</tr>
		<tr style="height:20%; width:100%; display: table-row">
			<td colspan="2">
				<div id="tree_chart"></div>
			</td>
		</tr>
	</table>


</body>

</html>